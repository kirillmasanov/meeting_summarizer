# Meeting Summarizer - Yandex Cloud Blueprint

## 1. Введение

**Название проекта:** Meeting Summarizer

**Описание задачи:**

Meeting Summarizer — это веб-приложение для автоматической обработки видеозаписей встреч с извлечением аудио, транскрибацией речи в текст и созданием структурированного резюме встречи. Приложение использует асинхронное распознавание речи Yandex SpeechKit API v3 со встроенной суммаризацией через модели из Yandex AI Studio Model Gallery на основе настраиваемого системного промпта.

Решение позволяет значительно сократить время на обработку записей встреч, автоматически создавая структурированные резюме.

**Основные сервисы Yandex Cloud:**
- Yandex SpeechKit API v3 (распознавание речи и суммаризация через встроенную интеграцию с AI Studio Model Gallery)

**Цель и ожидаемый результат:**

После выполнения инструкций из этого документа вы получите работающее веб-приложение, которое:
- Принимает видеофайлы встреч (MP4, WebM)
- Автоматически извлекает аудиодорожку
- Транскрибирует речь в текст
- Создает структурированное резюме встречи
- Предоставляет удобный веб-интерфейс для работы

---

## 2. Архитектура решения

### Описание архитектуры

Приложение построено на основе FastAPI и работает как веб-сервис с асинхронной обработкой задач. Пользователь загружает видеофайл через веб-интерфейс, после чего запускается pipeline обработки:

1. **Загрузка видео** → Сохранение на сервере
2. **Извлечение аудио** → Конвертация в MP3 с помощью ffmpeg
3. **Асинхронная транскрибация и суммаризация** → Отправка аудио в Yandex SpeechKit API v3 для асинхронного распознавания речи с автоматическим созданием резюме через встроенную интеграцию с AI Studio Model Gallery
4. **Результат** → Отображение структурированного резюме в веб-интерфейсе

### Компоненты системы

```
┌─────────────────┐
│   Пользователь  │
└────────┬────────┘
         │ HTTP
         ▼
┌─────────────────────────────────────┐
│      FastAPI Web Application        │
│  ┌───────────────────────────────┐  │
│  │   Static Files (HTML/CSS/JS)  │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │   Background Task Queue       │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │   FFmpeg Audio Extraction     │  │
│  └───────────────────────────────┘  │
└────────┬───────────────────────────┘
         │ HTTPS API
         ▼
┌─────────────────────────────────────┐
│      Yandex SpeechKit API v3        │
│  ┌───────────────────────────────┐  │
│  │   Async Speech Recognition    │  │
│  └───────────────────────────────┘  │
│  ┌───────────────────────────────┐  │
│  │   Integrated Summarization    │  │
│  │   (via AI Studio Model Gallery)│  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

### Используемые сервисы Yandex Cloud

| Сервис | Назначение | Необходимые роли для сервисного аккаунта |
|--------|------------|-------------------------------------------|
| **Yandex SpeechKit API v3** | Асинхронное распознавание речи из аудиофайлов с поддержкой длинных записей (до 4 часов) и встроенной суммаризацией через AI Studio Model Gallery | - `ai.speechkit-stt.user` — доступ к API распознавания речи<br>- `ai.languageModels.user` — доступ к языковым моделям для суммаризации |

### Особенности реализации

- **Асинхронная обработка**: Использование FastAPI BackgroundTasks для неблокирующей обработки и асинхронного API SpeechKit для распознавания длинных аудиозаписей
- **Автоматическая очистка**: Временные файлы удаляются сразу после обработки
- **Настраиваемый промпт**: Возможность изменения инструкций для суммаризации через веб-интерфейс
- **Docker-ready**: Полная поддержка контейнеризации с автоматической установкой зависимостей

---

## 3. Подготовка окружения

### Системные требования

- **Python 3.8+**
- **ffmpeg** (для извлечения аудио из видео)
- **Docker и Docker Compose** (опционально, для контейнеризации)

### Установка зависимостей

#### Вариант 1: Локальная установка с uv

```bash
# Установка uv (менеджер пакетов Python)
curl -LsSf https://astral.sh/uv/install.sh | sh

# Добавление uv в PATH
echo 'export PATH="$HOME/.uv/bin:$PATH"' >> ~/.bashrc
source ~/.bashrc

# Клонирование репозитория
git clone https://github.com/kirillmasanov/meeting-summarizer
cd meeting-summarizer

# Установка зависимостей
uv sync
```

#### Вариант 2: Docker

```bash
# Клонирование репозитория
git clone https://github.com/kirillmasanov/meeting-summarizer
cd meeting-summarizer

# Docker автоматически установит все зависимости при сборке
```

### Установка ffmpeg

**macOS:**
```bash
brew install ffmpeg
```

**Ubuntu/Debian:**
```bash
sudo apt-get update
sudo apt-get install ffmpeg
```

**Проверка установки:**
```bash
ffmpeg -version
```

### Настройка Yandex Cloud CLI (опционально)

Для автоматизации создания ресурсов установите Yandex Cloud CLI:

```bash
# Установка yc CLI
curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash

# Инициализация и конфигурация
yc init
```

---

## 4. Развёртывание инфраструктуры

### 4.1. Создание сервисного аккаунта

#### Через веб-консоль:

1. Перейдите в [консоль Yandex Cloud](https://console.cloud.yandex.ru/)
2. Выберите ваш каталог
3. Перейдите в раздел "Сервисные аккаунты"
4. Нажмите "Создать сервисный аккаунт"
5. Укажите имя, например, `meeting-summarizer-sa`
6. Добавьте описание, например, "Service account for meeting summarizer app"

#### Через CLI:

```bash
# Создание сервисного аккаунта
yc iam service-account create \
  --name meeting-summarizer-sa \
  --description "Service account for meeting summarizer app"

# Получение ID созданного аккаунта
SA_ID=$(yc iam service-account get meeting-summarizer-sa --format json | jq -r '.id')
echo "Service Account ID: $SA_ID"
```

### 4.2. Назначение ролей

Сервисному аккаунту необходимы две роли:

#### Через веб-консоль:

1. Откройте страницу каталога
2. Перейдите на вкладку "Права доступа"
3. Нажмите "Назначить роли"
4. Выберите сервисный аккаунт `meeting-summarizer-sa`
5. Добавьте роли:
   - `ai.speechkit-stt.user`
   - `ai.languageModels.user`

#### Через CLI:

```bash
# Получение FOLDER_ID
FOLDER_ID=$(yc config get folder-id)

# Назначение роли для SpeechKit
yc resource-manager folder add-access-binding $FOLDER_ID \
  --role ai.speechkit-stt.user \
  --service-account-id $SA_ID

# Назначение роли для AI Studio Model Gallery
yc resource-manager folder add-access-binding $FOLDER_ID \
  --role ai.languageModels.user \
  --service-account-id $SA_ID
```

### 4.3. Создание API ключа

#### Через веб-консоль:

1. Откройте страницу сервисного аккаунта
2. Перейдите на вкладку "API-ключи"
3. Нажмите "Создать API-ключ"
4. **Важно:** Скопируйте ключ (он показывается только один раз!)

#### Через CLI:

```bash
# Создание API-ключа
API_KEY=$(yc iam api-key create --service-account-id $SA_ID --format json | jq -r '.secret')
echo "API Key: $API_KEY"
```

### 4.4. Настройка переменных окружения

Создайте файл `.env` в корне проекта:

```bash
cat > .env << EOF
YANDEX_API_KEY=<ваш_api_ключ>
FOLDER_ID=<ваш_folder_id>
LLM_MODEL=qwen3-235b-a22b-fp8/latest
SERVER_PORT=8000
EOF
```

**Автоматическое создание через CLI:**

```bash
FOLDER_ID=$(yc config get folder-id)
SA_ID=$(yc iam service-account get meeting-summarizer-sa --format json | jq -r '.id')
API_KEY=$(yc iam api-key create --service-account-id $SA_ID --format json | jq -r '.secret')

cat > .env << EOF
YANDEX_API_KEY=$API_KEY
FOLDER_ID=$FOLDER_ID
LLM_MODEL=qwen3-235b-a22b-fp8/latest
SERVER_PORT=8000
EOF

echo "Файл .env создан успешно"
```

---

## 5. Запуск приложения

### Вариант 1: Запуск с использованием Python

```bash
# Запуск приложения
uv run python app.py
```

Приложение будет доступно на порту **8000** (или на порту, указанном в переменной `SERVER_PORT`).

### Вариант 2: Запуск с использованием Docker

```bash
# Сборка и запуск контейнера
docker compose up -d

# Просмотр логов
docker compose logs -f

# Проверка статуса
docker compose ps
```

Приложение будет доступно на порту **8000** (или на порту, указанном в переменной `SERVER_PORT`).

### Проверка работоспособности

Откройте в браузере:
- **При локальном запуске:** `http://localhost:8000`
- **При запуске на виртуальной машине:** `http://<IP-адрес-ВМ>:8000`

**Примечание:** При развертывании на виртуальной машине в Yandex Cloud убедитесь, что:
- В группе безопасности открыт порт 8000 (или ваш кастомный порт)
- У виртуальной машины есть публичный IP-адрес (если требуется доступ из интернета)

Вы должны увидеть веб-интерфейс с:
- Областью для загрузки видеофайлов (drag-and-drop)
- Раскрывающейся секцией настроек промпта
- Кнопкой "Загрузить и обработать"

---

## 6. Тестирование решения

### 6.1. Подготовка тестового видео

Для тестирования используйте видеофайл встречи:
- Формат: MP4 или WebM
- Размер: до 1 GB
- Длительность: до 4 часов
- Язык: русский

### 6.2. Тестирование через веб-интерфейс

1. Откройте приложение в браузере (см. раздел "Проверка работоспособности")
2. Перетащите видеофайл в область загрузки
3. (Опционально) Раскройте "Настройки промпта" и отредактируйте инструкции
4. Нажмите "Загрузить и обработать"
5. Наблюдайте за прогрессом обработки:
   - Загрузка файла
   - Извлечение аудио
   - Транскрибация и суммаризация
   - Обработка завершена
6. Просмотрите результат - структурированное резюме встречи
7. Используйте кнопку "Копировать" для копирования результата

### 6.3. Тестирование через API

**Примечание:** Замените `<HOST>` на `localhost` при локальном запуске или на IP-адрес вашей виртуальной машины.

```bash
# Загрузка видео
curl -X POST http://<HOST>:8000/api/upload \
  -F "file=@meeting.mp4" \
  -F "system_prompt=Создай краткое резюме встречи"

# Ответ: {"task_id": "uuid", "message": "Файл загружен, обработка начата"}

# Проверка статуса
curl http://<HOST>:8000/api/status/<task_id>

# Получение результата
curl http://<HOST>:8000/api/result/<task_id>
```

### 6.4. Проверка логов

```bash
# Для локального запуска - логи выводятся в консоль

# Для Docker
docker compose logs -f meeting-summarizer
```

---

## 7. Результаты и выводы

### Ожидаемый результат

После успешной обработки видеофайла вы получите структурированное резюме встречи в текстовом формате. Содержание и структура резюме определяются системным промптом, который можно настроить под ваши потребности.

По умолчанию резюме включает:
- Краткое изложение основных моментов встречи
- Информацию об участниках и контексте
- Ключевые обсуждаемые темы
- Договоренности и следующие шаги

Вы можете изменить системный промпт через веб-интерфейс или в файле `system_prompt.txt`, чтобы адаптировать формат резюме под специфику ваших встреч.

### Преимущества решения

- **Автоматизация**: Полностью автоматическая обработка от видео до резюме
- **Точность**: Использование Yandex SpeechKit API v3 для качественной транскрибации
- **Гибкость**: Настраиваемый системный промпт для разных типов встреч
- **Удобство**: Простой веб-интерфейс с drag-and-drop
- **Масштабируемость**: Docker-ready решение для развертывания в любом окружении

---

## 8. Очистка ресурсов

### Остановка приложения

**Локальный запуск:**
```bash
# Остановка приложения (Ctrl+C в терминале)
```

**Docker:**
```bash
# Остановка контейнера
docker compose down

# Полная очистка (включая volumes)
docker compose down -v
```

### Удаление сервисного аккаунта (опционально)

```bash
# Получение ID сервисного аккаунта
SA_ID=$(yc iam service-account get meeting-summarizer-sa --format json | jq -r '.id')

# Удаление API ключей
yc iam api-key list --service-account-id $SA_ID --format json | \
  jq -r '.[].id' | \
  xargs -I {} yc iam api-key delete {}

# Удаление сервисного аккаунта
yc iam service-account delete $SA_ID
```

---

## 9. Полезные ссылки

### Документация Yandex Cloud

- [Yandex SpeechKit](https://cloud.yandex.ru/docs/speechkit/)
- [Yandex AI Studio Model Gallery](https://yandex.cloud/ru/docs/ai-studio/concepts/generation/models)
- [Управление доступом в Yandex Cloud](https://cloud.yandex.ru/docs/iam/)
- [Сервисные аккаунты](https://cloud.yandex.ru/docs/iam/concepts/users/service-accounts)

### Репозиторий проекта

- [GitHub: meeting-summarizer](https://github.com/kirillmasanov/meeting-summarizer)

### Дополнительная документация

- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [Docker Documentation](https://docs.docker.com/)
- [FFmpeg Documentation](https://ffmpeg.org/documentation.html)


---

## Примечания

### Ограничения

- Максимальный размер видеофайла: 1 GB
- Максимальная длительность видео: 4 часа (240 минут)
- Поддерживаемые форматы: MP4, WebM
- Язык распознавания: русский (можно настроить в коде)

### Рекомендации

- Используйте видео с хорошим качеством звука для лучших результатов транскрибации
- Настройте системный промпт под специфику ваших встреч
- Для production развертывания используйте Docker с настроенным reverse proxy (nginx)
- Регулярно обновляйте зависимости для получения последних исправлений безопасности

### Стоимость использования

Стоимость использования зависит от:
- Длительности обрабатываемых аудиозаписей (SpeechKit API)
- Объема текста для суммаризации (AI Studio Model Gallery)

Актуальные цены см. на странице тарифов [Yandex SpeechKit](https://yandex.cloud/ru/docs/speechkit/pricing) и [Yandex AI Studio](https://yandex.cloud/ru/docs/ai-studio/pricing).